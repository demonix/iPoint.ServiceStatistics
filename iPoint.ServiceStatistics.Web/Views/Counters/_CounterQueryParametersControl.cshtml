@using System.Collections.Specialized
@using System.Globalization
@model iPoint.ServiceStatistics.Web.Models.CounterQueryParameters

<script src="@Url.Content("~/Scripts/jquery-ui-1.8.17.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui.timepicker.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui.datepicker-ru.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui.timepicker-ru.js")" type="text/javascript"></script>

<link rel="stylesheet" href="@Url.Content("~/Content/themes/base/jquery-ui-1.8.17.custom.css")" />
<link rel="stylesheet" href="@Url.Content("~/Content/themes/base/jquery.ui.datepicker.css")" />
<link rel="stylesheet" href="@Url.Content("~/Content/themes/base/jquery.ui.slider.css")"  />
<link rel="stylesheet" href="@Url.Content("~/Content/themes/base/jquery.ui.timepicker.css")"  />

<script type="text/javascript">
    $(function () {

        $.getJSON("/Counters/CounterCategories", { sd: $("#StartDate").val(), ed: $("#EndDate").val() }, function (data) {
            setSelectorItems(data, "#CounterCategory");
        });

        $("#CounterCategory").change(function () {
            $.getJSON("/Counters/CounterNames", { sd: $("#StartDate").val(), ed: $("#EndDate").val(), cc: $("#CounterCategory").val() }, function (data) {
                setSelectorItems(data, "#CounterName");
            });

        });

        $("#CounterName").change(function () {
            $.getJSON("/Counters/CounterDetails", { sd: $("#StartDate").val(), ed: $("#EndDate").val(), cc: $("#CounterCategory").val(), cn: $("#CounterName").val() }, function (data) {
                setSelectorItems(data.Sources, "#CounterSource");
                setSelectorItems(data.Instances, "#CounterInstance");
                setSelectorItems(data.ExtDatas, "#CounterExtData");
            });
        });




        function setSelectorItems(data, category) {
            var ccSelector = $(category);
            ccSelector.empty();
            $.each(data, function (index, item) {
                ccSelector.append($("<option/>", { value: item.Value, text: item.Text }));
            });
            ccSelector.change();
        }
    });
</script>

<div id="initalparameter">
    <table width="100%">
        <tr>
            <td>
                @Html.LabelFor(cModel => cModel.CounterCategory)
                @Html.DropDownListFor(cModel => cModel.CounterCategory, Model.CounterCategories, new { @class = "queryParameter" })
            </td>
            <td>
                @Html.LabelFor(cModel => cModel.CounterName)
                @Html.DropDownListFor(cModel => cModel.CounterName, Model.CounterNames, new { @class = "queryParameter" })
            </td>
            <td>
                @Html.LabelFor(cModel => cModel.CounterSource)
                @Html.DropDownListFor(cModel => cModel.CounterSource, Model.CounterSources, new { @class = "queryParameter" })
            </td>
            <td>
                @Html.LabelFor(cModel => cModel.CounterInstance)
                @Html.DropDownListFor(cModel => cModel.CounterInstance, Model.CounterInstances, new { @class = "queryParameter" })
            </td>
            <td>
                @Html.LabelFor(cModel => cModel.CounterExtData)
                @Html.DropDownListFor(cModel => cModel.CounterExtData, Model.CounterExtDatas, new { @class = "queryParameter" })
            </td>
        </tr>
    </table>
    <table>
        <tr>
            <td>
                @Html.LabelFor(cModel => cModel.StartDate)
                @Html.EditorFor(cModel => cModel.StartDate)
                @*<input name="leftDateDDL" type="text" id="leftDateDDL" value="@DateTime.Now.AddDays(-1).ToString(CultureInfo.InvariantCulture)" />*@
            </td>
            <td>
                @Html.LabelFor(cModel => cModel.EndDate)
                @Html.EditorFor(cModel => cModel.EndDate)
                @*<input name="rightDateDDL" type="text" id="rightDateDDL" value="@DateTime.Now.ToString(CultureInfo.InvariantCulture)" />*@
            </td>
            <td>
                <input id="drawBtn" type="button" value="Draw" onclick="draw()" />
                <!--input id="drawBtn" type="button" value="Update" onclick="update()" /-->
            </td>
        </tr>
    </table>
</div>
<script language="javascript">
    $("#StartDate").datetimepicker({showSecond: true});
    $("#EndDate").datetimepicker({showSecond: true});
    var dr;
    function draw() {
        var sd = $("#StartDate").val();
        var ed = $("#EndDate").val();
        var cc = $("#CounterCategory").val();
        var cn = $("#CounterName").val();
        var cs = $("#CounterSource").val();
        var ci = $("#CounterInstance").val();
        var ced = $("#CounterExtData").val();
        if (dr)
            dr.Dispose();
        dr = new Drawer($("#placeholder"), { sd: sd, ed: ed, cc: cc, cn: cn, cs: cs, ci: ci, ced: ced });
        dr.UpdateAndDraw(5000);
    }
    function update() {
        dr.UpdateAndDraw();
    }

</script>
@Html.Partial("_CountersGraph")

@*
@Html.EditorFor(model => model.StartDate)<br/>
@Html.EditorFor(model => model.EndDate)<br/>
@Html.DropDownListFor(model => model.CounterCategory, new SelectList(new List<string>()))<br/>
@Html.EditorFor(model => model.CounterName)<br/>
@Html.EditorFor(model => model.CounterInstance)<br/>
@Html.EditorFor(model => model.CounterExtData)<br/>

*@